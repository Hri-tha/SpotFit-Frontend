<!-- product-list.html - FIXED -->
<!-- âœ… Navbar -->
<nav class="navbar">
  <!-- Left hamburger menu -->
  <div class="hamburger-left mobile-only" (click)="toggleMenu()">
    <span></span>
    <span></span>
    <span></span>
  </div>

  <!-- Mobile logo (visible only on mobile) -->
  <div class="mobile-nav-logo mobile-only" (click)="goHome()">
    <span style="font-size:16px;font-weight:700;letter-spacing:0.5px;
                 font-family:Poppins,Arial,sans-serif;color:#222;">
      Spot<span style="color:#c1121f;">Fit</span>
    </span>
  </div>

  <!-- Desktop logo (hidden on mobile) -->
  <div class="logo desktop-only" (click)="goHome()">
    <img src="Screen_Sorrt.png" alt="SpotFit Logo" class="logo-img" />
    <span>Spot<span>Fit</span></span>
  </div>

  <!-- Normal nav links (hidden on mobile) -->
  <ul class="nav-links desktop-only">
    <li (click)="filterByType('Lower')">Lower</li>
    <li (click)="filterByType('Sando')">Sando</li>
    <li (click)="filterByType('T-Shirt')">T-Shirt</li>
    <li (click)="filterByType('Nikker')">Nikker</li>
    <li (click)="filterByType('New Arrivals')">New Arrivals</li>
    <li (click)="resetFilter()">All</li>
  </ul>

  <button class="btn-buy-now" (click)="handleBuyNow()">
    Buy Now
  </button>

  <!-- Replace this section in your navbar -->
  <div class="nav-icons">
    <!-- ðŸ›’ Cart with Badge -->
    <div class="cart-icon" (click)="goToCart()">
      <img src="CartImage.jpg" alt="Cart" class="cart-img" />
      <span *ngIf="cartCount > 0" class="cart-badge">{{ cartCount }}</span>
    </div>

    <!-- âœ… User Profile (when logged in) -->
    <div *ngIf="isLoggedIn; else loginButton" class="user-profile desktop-only" [class.active]="userDropdownOpen"
      (click)="toggleUserDropdown()">

      <div class="user-avatar">
        {{ getUserInitials() }}
      </div>
      <span class="user-name">{{ getUserName() }}</span>

      <!-- User Dropdown Menu -->
      <div class="user-dropdown">
        <div class="user-dropdown-item" (click)="goToProfile()">
          <i class="fas fa-user"></i>
          My Profile
        </div>
        <div class="user-dropdown-item" (click)="goToOrders()">
          <i class="fas fa-shopping-bag"></i>
          My Orders
        </div>
        <div class="user-dropdown-divider"></div>
        <div class="user-dropdown-item" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>
          Logout
        </div>
      </div>
    </div>

    <!-- âœ… Login Button (when not logged in) -->
    <ng-template #loginButton>
      <button class="btn-login desktop-only" (click)="goLogin()">Login</button>
    </ng-template>
  </div>
</nav>

<!-- Mobile menu (left side) -->
<!-- Mobile menu (left side) -->
<div class="mobile-menu-left" [class.active]="menuOpen">
  <div class="mobile-logo">
    <img src="Screen_Sorrt.png" alt="SpotFit Logo" />
    <span>Spot<span>Fit</span></span>
  </div>

  <ul>
    <li (click)="filterByTypeAndClose('Lower')"><i class="fas fa-tshirt"></i> Lower</li>
    <li (click)="filterByTypeAndClose('Sando')"><i class="fas fa-vest"></i> Sando</li>
    <li (click)="filterByTypeAndClose('T-Shirt')"><i class="fas fa-tshirt"></i> T-Shirt</li>
    <li (click)="filterByTypeAndClose('Nikker')"><i class="fas fa-shoe-prints"></i> Nikker</li>
    <li (click)="filterByTypeAndClose('New Arrivals')"><i class="fas fa-star"></i> New Arrivals</li>
    <li (click)="resetFilterAndClose()"><i class="fas fa-boxes"></i> All Products</li>

    <!-- Show login or user profile based on auth state -->
    <li *ngIf="!isLoggedIn" (click)="goLoginAndClose()">
      <i class="fas fa-user"></i> Login
    </li>

    <li *ngIf="isLoggedIn" (click)="goToProfileAndClose()">
      <i class="fas fa-user"></i> My Profile
    </li>
    <li *ngIf="isLoggedIn" (click)="goToOrdersAndClose()">
      <i class="fas fa-shopping-bag"></i> My Orders
    </li>
    <li *ngIf="isLoggedIn" (click)="logoutAndClose()">
      <i class="fas fa-sign-out-alt"></i> Logout
    </li>

    <li (click)="goToCartAndClose()">
      <i class="fas fa-shopping-cart"></i> Cart ({{ cartCount }})
    </li>
  </ul>
</div>

<!-- Overlay for when menu is open -->
<div class="overlay" [class.active]="menuOpen" (click)="closeMenu()"></div>

<!-- âœ… Size Selection Modal - FIXED -->
<div class="size-modal-overlay" [class.active]="showSizeModal" (click)="closeSizeModal()">
  <div class="size-modal" *ngIf="selectedProduct" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Select Size</h3>
      <button class="modal-close" (click)="closeSizeModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <div class="product-preview">
        <img [src]="getProductImage(selectedProduct)" [alt]="selectedProduct.title"
          onerror="this.src='assets/placeholder-image.jpg'" />
        <div class="product-info">
          <h4>{{ selectedProduct.title || 'Product' }}</h4>
          <div class="price">
            <span class="current-price">â‚¹{{ getDiscountedPrice(selectedProduct) }}</span>
            <span *ngIf="selectedProduct.discount && selectedProduct.discount > 0" class="original-price">
              â‚¹{{ selectedProduct.price }}
            </span>
            <span *ngIf="selectedProduct.discount && selectedProduct.discount > 0" class="discount">
              {{ selectedProduct.discount }}% OFF
            </span>
          </div>
        </div>
      </div>

      <div class="size-selection">
        <div class="size-header">
          <span class="size-label">SELECT SIZE</span>
          <span class="size-guide" (click)="openSizeGuide()">Size Guide</span>
        </div>

        <div class="size-grid" *ngIf="selectedProduct.sizes && selectedProduct.sizes.length > 0; else noSizes">
          <button *ngFor="let size of selectedProduct.sizes" class="size-option"
            [class.selected]="selectedSize === size" [class.out-of-stock]="isSizeOutOfStock(size)"
            (click)="selectSize(size)" [disabled]="isSizeOutOfStock(size)">
            <span class="size-text">{{ size }}</span>
            <span *ngIf="isSizeOutOfStock(size)" class="stock-status">Out of Stock</span>
          </button>
        </div>

        <ng-template #noSizes>
          <div class="no-sizes-message">
            <p>This product doesn't require size selection.</p>
          </div>
        </ng-template>

        <div *ngIf="sizeError" class="error-message">
          {{ sizeError }}
        </div>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn-secondary" (click)="closeSizeModal()">Cancel</button>
      <button class="btn-primary"
        [disabled]="(selectedProduct.sizes && selectedProduct.sizes.length > 0 && !selectedSize) || isSizeOutOfStock(selectedSize)"
        (click)="confirmSizeSelection()">
        {{ isBuyNowMode ? 'Buy Now' : 'Add to Cart' }}
      </button>
    </div>
  </div>
</div>

<!-- âœ… Size Guide Modal -->
<div class="size-guide-modal" [class.active]="showSizeGuide" (click)="closeSizeGuide()">
  <div class="size-guide-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Size Guide</h3>
      <button class="modal-close" (click)="closeSizeGuide()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
        </svg>
      </button>
    </div>

    <div class="size-guide-body">
      <div class="guide-section">
        <h4>How to choose your size:</h4>
        <ul>
          <li>Measure your chest/bust and waist</li>
          <li>Compare with our size chart</li>
          <li>If between sizes, choose the larger size</li>
        </ul>
      </div>

      <div class="size-chart">
        <h4>Size Chart (in inches)</h4>
        <table>
          <thead>
            <tr>
              <th>Size</th>
              <th>Chest</th>
              <th>Waist</th>
              <th>Fit</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>S</td>
              <td>34-36</td>
              <td>28-30</td>
              <td>Regular</td>
            </tr>
            <tr>
              <td>M</td>
              <td>38-40</td>
              <td>32-34</td>
              <td>Regular</td>
            </tr>
            <tr>
              <td>L</td>
              <td>42-44</td>
              <td>36-38</td>
              <td>Regular</td>
            </tr>
            <tr>
              <td>XL</td>
              <td>46-48</td>
              <td>40-42</td>
              <td>Regular</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- âœ… Dynamic Hero Banner -->
<div *ngIf="heroBanners.length > 0" class="hero-banner-container">
  <div class="hero-banner" *ngFor="let banner of heroBanners; let i = index" [class.active]="i === currentBannerIndex">

    <div class="image-wrapper">
      <img [src]="getProductImage(banner)" [alt]="banner.title" />
    </div>

    <div class="hero-text">
      <h1>{{ banner.title }}</h1>
      <p>{{ banner.description }}</p>
      <button class="btn-shop" (click)="handleShopNow()">Shop Now</button>
    </div>
  </div>

  <!-- âœ… Banner Navigation Dots -->
  <div class="banner-dots" *ngIf="heroBanners.length > 1">
    <span *ngFor="let banner of heroBanners; let i = index" [class.active]="i === currentBannerIndex"
      (click)="goToBanner(i)" class="banner-dot">
    </span>
  </div>
</div>

<!-- âœ… Fallback Featured Banner -->
<div *ngIf="heroBanners.length === 0 && featuredProduct" class="hero-banner">
  <img [src]="featuredProduct.imageUrl" alt="{{featuredProduct.title}}" />
  <div class="hero-text">
    <h1>{{ featuredProduct.title }}</h1>
    <p>{{ featuredProduct.description }}</p>
    <button class="btn-shop" (click)="handleShopNow()">Shop Now</button>
  </div>
</div>

<!-- âœ… Product Grid (updated buttons) -->
<div class="product-container">
  <div class="product-card" *ngFor="let p of normalProducts" (mouseenter)="onProductHover(p)"
    (mouseleave)="onProductLeave(p)">

    <div class="image-wrapper">
      <img [src]="getProductImage(p, p._id ? (currentImageIndex[p._id] || 0) : 0)" [alt]="p.title" />

      <div class="image-count" *ngIf="p.images && p.images.length > 1">
        {{ (p._id ? (currentImageIndex[p._id] || 0) : 0) + 1 }}/{{ p.images.length }}
      </div>
    </div>

    <div class="product-info">
      <h3 class="title">{{ p.title }}</h3>
      <p class="description">{{ p.description }}</p>

      <!-- âœ… Price -->
      <div class="price-section" *ngIf="p.discount && p.discount > 0; else noDiscount">
        <span class="old-price">â‚¹{{ p.price }}</span>
        <span class="new-price">â‚¹{{ getDiscountedPrice(p) }}</span>
        <span class="discount-tag">-{{ p.discount }}%</span>
      </div>
      <ng-template #noDiscount>
        <span class="new-price">â‚¹{{ p.price }}</span>
      </ng-template>

      <!-- âœ… Sizes Preview -->
      <div class="sizes-preview" *ngIf="p.sizes && p.sizes.length > 0">
        <strong>Available Sizes:</strong>
        <div class="size-chips">
          <span *ngFor="let size of p.sizes.slice(0, 3)" class="size-chip">{{ size }}</span>
          <span *ngIf="p.sizes.length > 3" class="more-sizes">+{{ p.sizes.length - 3 }} more</span>
        </div>
      </div>

      <!-- âœ… Add to Cart -->
      <div class="price-add">
        <ng-container *ngIf="getCartQuantity(p) > 0; else addToCartBtn">
          <div class="quantity-controls">
            <button class="btn-qty" (click)="decreaseQuantity(p)">-</button>
            <span class="qty-display">{{ getCartQuantity(p) }}</span>
            <button class="btn-qty" (click)="increaseQuantity(p)">+</button>
          </div>
        </ng-container>

        <ng-template #addToCartBtn>
          <button class="btn-add" [disabled]="p.quantity === 0" (click)="openSizeModal(p, false)">
            {{ p.quantity === 0 ? "Out of Stock" : "Add to Cart" }}
          </button>
        </ng-template>
      </div>

      <!-- âœ… Buy Now Button -->
      <button class="btn-buy-now" (click)="openSizeModal(p, true)" [disabled]="p.quantity === 0">
        Buy Now
      </button>
    </div>
  </div>
</div>