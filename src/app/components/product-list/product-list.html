<!-- product-list.html - FIXED -->
<!-- âœ… Navbar -->
<nav class="navbar">
  <!-- Left hamburger menu -->
  <div class="hamburger-left mobile-only" (click)="toggleMenu()">
    <span></span>
    <span></span>
    <span></span>
  </div>

  <!-- Mobile logo (visible only on mobile) -->
  <div class="mobile-nav-logo mobile-only" (click)="goHome()">
    <span style="font-size:16px;font-weight:700;letter-spacing:0.5px;
                 font-family:Poppins,Arial,sans-serif;color:#222;">
      Spot<span style="color:#c1121f;">Fit</span>
    </span>
  </div>

  <!-- Desktop logo (hidden on mobile) -->
  <div class="logo desktop-only" (click)="goHome()">
    <img src="Screen_Sorrt.png" alt="SpotFit Logo" class="logo-img" />
    <span>Spot<span>Fit</span></span>
  </div>

  <!-- Normal nav links (hidden on mobile) -->
  <ul class="nav-links desktop-only">
    <li (click)="filterByType('Lower')">Lower</li>
    <li (click)="filterByType('Sando')">Sando</li>
    <li (click)="filterByType('T-Shirt')">T-Shirt</li>
    <li (click)="filterByType('Nikker')">Nikker</li>
    <li (click)="filterByType('New Arrivals')">New Arrivals</li>
    <li (click)="resetFilter()">All</li>
  </ul>
<button class="btn-buy-now " (click)="handleBuyNow()">
      Buy Now
</button>
  <div class="nav-icons">
   
    <!-- ðŸ›’ Cart with Badge -->
    <div class="cart-icon" (click)="goToCart()">
      <img src="CartImage.jpg" alt="Cart" class="cart-img" />
      <span *ngIf="cartCount > 0" class="cart-badge">{{ cartCount }}</span>
    </div>

    <button class="btn-login desktop-only" (click)="goLogin()">Login</button>
  </div>
</nav>

<!-- Mobile menu (left side) -->
<div class="mobile-menu-left" [class.active]="menuOpen">
  <div class="mobile-logo">
    <img src="Screen_Sorrt.png" alt="SpotFit Logo" />
    <span>Spot<span>Fit</span></span>
  </div>
  
  <ul>
    <li (click)="filterByTypeAndClose('Lower')"><i class="fas fa-tshirt"></i> Lower</li>
    <li (click)="filterByTypeAndClose('Sando')"><i class="fas fa-vest"></i> Sando</li>
    <li (click)="filterByTypeAndClose('T-Shirt')"><i class="fas fa-tshirt"></i> T-Shirt</li>
    <li (click)="filterByTypeAndClose('Nikker')"><i class="fas fa-shoe-prints"></i> Nikker</li>
    <li (click)="filterByTypeAndClose('New Arrivals')"><i class="fas fa-star"></i> New Arrivals</li>
    <li (click)="resetFilterAndClose()"><i class="fas fa-boxes"></i> All Products</li>
    <li (click)="goLoginAndClose()"><i class="fas fa-user"></i> Login</li>
    <li (click)="goToCartAndClose()"><i class="fas fa-shopping-cart"></i> Cart ({{ cartCount }})</li>
  </ul>
</div>

<!-- Overlay for when menu is open -->
<div class="overlay" [class.active]="menuOpen" (click)="closeMenu()"></div>

<!-- âœ… Dynamic Hero Banner -->
<div *ngIf="heroBanners.length > 0" class="hero-banner-container">
  <div class="hero-banner" 
       *ngFor="let banner of heroBanners; let i = index"
       [class.active]="i === currentBannerIndex">
    
    <div class="image-wrapper">
      <img [src]="getProductImage(banner)" [alt]="banner.title" />
    </div>
    
    <div class="hero-text">
      <h1>{{ banner.title }}</h1>
      <p>{{ banner.description }}</p>
      <button class="btn-shop"  (click)="handleShopNow()">Shop Now</button>
    </div>
  </div>

  <!-- âœ… Banner Navigation Dots -->
  <div class="banner-dots" *ngIf="heroBanners.length > 1">
    <span *ngFor="let banner of heroBanners; let i = index"
          [class.active]="i === currentBannerIndex"
          (click)="goToBanner(i)"
          class="banner-dot">
    </span>
  </div>
</div>

<!-- âœ… Fallback Featured Banner -->
<div *ngIf="heroBanners.length === 0 && featuredProduct" class="hero-banner">
  <img [src]="featuredProduct.imageUrl" alt="{{featuredProduct.title}}" />
  <div class="hero-text">
    <h1>{{ featuredProduct.title }}</h1>
    <p>{{ featuredProduct.description }}</p>
    <button class="btn-shop" (click)="handleShopNow()">Shop Now</button>
  </div>
</div>

<!-- âœ… Product Grid -->
<div class="product-container">
  <div class="product-card" 
       *ngFor="let p of normalProducts"
       (mouseenter)="onProductHover(p)"
       (mouseleave)="onProductLeave(p)">
    
    <div class="image-wrapper">
      <!-- Fix: Safe image access -->
      <img [src]="getProductImage(p, p._id ? (currentImageIndex[p._id] || 0) : 0)" 
           [alt]="p.title" 
           [title]="p.images && p.images.length > 1 ? 'Hover to see more images' : ''" />
      
      <!-- Fix: Remove Array.isArray check since we know it's an array from the interface -->
      <div class="image-count" *ngIf="p.images && p.images.length > 1">
        {{ (p._id ? (currentImageIndex[p._id] || 0) : 0) + 1 }}/{{ p.images.length }}
      </div>
    </div>

    <div class="product-info">
      <h3 class="title">{{ p.title }}</h3>
      <p class="description">{{ p.description }}</p>

      <!-- âœ… Price -->
      <div class="price-section" *ngIf="p.discount && p.discount > 0; else noDiscount">
        <span class="old-price">â‚¹{{ p.price }}</span>
        <span class="new-price">â‚¹{{ getDiscountedPrice(p) }}</span>
        <span class="discount-tag">-{{ p.discount }}%</span>
      </div>
      <ng-template #noDiscount>
        <span class="new-price">â‚¹{{ p.price }}</span>
      </ng-template>

      <!-- âœ… Sizes -->
      <div class="sizes" *ngIf="p.sizes && p.sizes.length > 0">
        <strong>Sizes:</strong>
        <span *ngFor="let size of p.sizes" class="size-chip">{{ size }}</span>
      </div>

      <!-- âœ… Add to Cart -->
      <div class="price-add">
        <ng-container *ngIf="getCartQuantity(p) > 0; else addToCartBtn">
          <div class="quantity-controls">
            <button class="btn-qty" (click)="decreaseQuantity(p)">-</button>
            <span class="qty-display">{{ getCartQuantity(p) }}</span>
            <button class="btn-qty" (click)="increaseQuantity(p)">+</button>
          </div>
        </ng-container>

        <ng-template #addToCartBtn>
          <button class="btn-add" 
                  [disabled]="p.quantity === 0" 
                  (click)="selectSizeAndAdd(p)">
            {{ p.quantity === 0 ? "Out of Stock" : "Add to Cart" }}
          </button>
        </ng-template>
      </div>

      <!-- âœ… Buy Now Button -->
      <button class="btn-buy-now" 
              (click)="buyNow(p)"
              [disabled]="p.quantity === 0">
        Buy Now
      </button>
    </div>
  </div>
</div>