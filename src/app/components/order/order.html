<!-- order.html -->
<div class="orders-page">
  <!-- Header -->
  <div class="orders-header">
    <h1>My Orders</h1>
    <p *ngIf="orders.length > 0">Track and manage your orders</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading your orders...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>Unable to load orders</h3>
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="loadOrders()">Try Again</button>
  </div>

  <!-- Empty State (No Orders) -->
  <div *ngIf="!isLoading && !error && orders.length === 0" class="empty-orders">
    <div class="empty-icon">üì¶</div>
    <h2>No Orders Yet</h2>
    <p>You haven't placed any orders. Start shopping to see your orders here!</p>
    <button class="btn-shop-now" (click)="continueShopping()">
      Start Shopping
    </button>
  </div>

  <!-- Orders List -->
  <div *ngIf="!isLoading && orders.length > 0" class="orders-list">
    <div *ngFor="let order of orders" class="order-card">
      
      <!-- Order Header - Always Visible -->
      <div class="order-header">
        <div class="order-info">
          <div class="order-id">Order #{{ order.orderId }}</div>
          <div class="order-date">Placed on {{ formatDate(order.createdAt) }}</div>
        </div>
        <div class="order-actions">
          <button 
            *ngIf="order.status === 'pending' || order.status === 'confirmed'" 
            class="btn-cancel" 
            (click)="cancelOrder(order._id)">
            Cancel Order
          </button>
          <button class="btn-details" (click)="toggleOrderDetails(order._id)">
            {{ isOrderExpanded(order._id) ? 'Hide Details' : 'View Details' }}
          </button>
        </div>
      </div>

      <!-- Order Status - Always Visible -->
      <div class="order-status">
        <div class="status-badge" [class]="getStatusClass(order.status)">
          {{ getStatusText(order.status) }}
        </div>
        <div *ngIf="order.expectedDelivery" class="delivery-date">
          Expected delivery: {{ formatDate(order.expectedDelivery) }}
        </div>
      </div>

      <!-- Basic Order Summary - Always Visible -->
      <div class="order-summary-basic">
        <div class="basic-info">
          <span class="product-name">{{ getFirstProductName(order) }}</span>
          <span *ngIf="order.items.length > 1" class="additional-items">
            +{{ order.items.length - 1 }} more item{{ order.items.length > 2 ? 's' : '' }}
          </span>
        </div>
        <div class="basic-total">
          Total: ‚Çπ{{ order.totalAmount }}
        </div>
      </div>

      <!-- Detailed Order Information - Expandable -->
      <div *ngIf="isOrderExpanded(order._id)" class="order-details-expanded">
        
        <!-- Order Items -->
        <div class="order-items">
          <h4>Order Items</h4>
          <div *ngFor="let item of order.items" class="order-item">
            <img [src]="item.image" [alt]="item.name" class="item-image" />
            <div class="item-details">
              <h4 class="item-name">{{ item.name }}</h4>
              <div class="item-meta">
                <span class="item-size" *ngIf="item.size">Size: {{ item.size }}</span>
                <span class="item-quantity">Qty: {{ item.quantity }}</span>
              </div>
              <div class="item-price">‚Çπ{{ item.price * item.quantity }}</div>
            </div>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
          <h4>Order Summary</h4>
          <div class="summary-row">
            <span>Total Items:</span>
            <span>{{ getTotalItems(order) }}</span>
          </div>
          <div class="summary-row">
            <span>Total Amount:</span>
            <span class="total-amount">‚Çπ{{ order.totalAmount }}</span>
          </div>
          <div class="summary-row" *ngIf="order.paymentMethod">
            <span>Payment Method:</span>
            <span>{{ order.paymentMethod }}</span>
          </div>
          <div class="summary-row" *ngIf="order.paymentStatus">
            <span>Payment Status:</span>
            <span [class]="'payment-' + order.paymentStatus">
              {{ order.paymentStatus }}
            </span>
          </div>
        </div>

        <!-- Shipping Address -->
        <div class="shipping-address" *ngIf="order.shippingAddress">
          <h4>Shipping Address</h4>
          <div class="address-details">
            <p><strong>{{ order.shippingAddress.name }}</strong></p>
            <p>{{ order.shippingAddress.address }}</p>
            <p>{{ order.shippingAddress.city }}, {{ order.shippingAddress.state }} - {{ order.shippingAddress.pincode }}</p>
            <p>Phone: {{ order.shippingAddress.phone }}</p>
          </div>
        </div>

        <!-- Tracking Section -->
        <div *ngIf="order.waybillNumber" class="tracking-section">
          <h4>Tracking Information</h4>
          <div class="tracking-info">
            <span class="tracking-label">Tracking Number:</span>
            <span class="tracking-number">{{ order.waybillNumber }}</span>
          </div>
          <button class="btn-track" (click)="trackOrder(order.waybillNumber)">
            Track Order
          </button>
        </div>

        <!-- Full Details Button -->
        <div class="full-details-section">
          <button class="btn-full-details" (click)="viewOrderDetails(order._id)">
            View Full Order Details
          </button>
        </div>
      </div>

    </div>
  </div>

  <!-- Load More Button -->
  <div *ngIf="orders.length > 0" class="load-more-section">
    <button class="btn-load-more" (click)="loadOrders()">
      Refresh Orders
    </button>
  </div>
</div>